<!-- apps/frontend/src/app/features/shop/checkout/checkout.component.html -->

<section class="py-12 md:py-20">
  <div class="container-custom max-w-4xl">
    <!-- Header -->
    <div class="text-center mb-12">
      <h1 class="heading-1 text-primary mb-4">
        <i class="pi pi-credit-card mr-3"></i>
        Finalizar Compra
      </h1>
      <p class="text-body text-secondary">
        Revise seu pedido e prossiga para o pagamento seguro
      </p>
    </div>

    <!-- Processing Overlay -->
    @if (processing()) {
      <div class="fixed inset-0 bg-dark/80 z-50 flex items-center justify-center">
        <div class="text-center">
          <p-progressSpinner strokeWidth="3" />
          <p class="text-primary mt-4">Processando seu pedido...</p>
          <p class="text-secondary text-sm mt-2">Você será redirecionado para o pagamento</p>
        </div>
      </div>
    }

    <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
      <!-- Customer Info -->
      <div class="lg:col-span-3 space-y-8">
        <!-- Account Info -->
        <div class="glass-card p-6">
          <h2 class="heading-3 text-primary mb-6 flex items-center gap-2">
            <i class="pi pi-user"></i>
            Dados do Cliente
          </h2>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="text-secondary text-sm">Nome:</label>
              <p class="text-primary font-medium">{{ user()?.fullName }}</p>
            </div>
            <div>
              <label class="text-secondary text-sm">Email:</label>
              <p class="text-primary font-medium">{{ user()?.email }}</p>
            </div>
            @if (user()?.phone) {
              <div>
                <label class="text-secondary text-sm">Telefone:</label>
                <p class="text-primary font-medium">{{ user()?.phone }}</p>
              </div>
            }
          </div>

          <a routerLink="/cliente/perfil" class="inline-block mt-4 text-accent hover:text-accent-light transition-colors text-sm">
            <i class="pi pi-pencil mr-1"></i>
            Editar dados
          </a>
        </div>

        <!-- Order Items -->
        <div class="glass-card p-6">
          <h2 class="heading-3 text-primary mb-6 flex items-center gap-2">
            <i class="pi pi-list"></i>
            Itens do Pedido
          </h2>

          <div class="space-y-4">
            @for (item of items(); track item.productId) {
              <div class="flex gap-4 p-4 bg-dark/30 rounded-lg">
                <!-- Image -->
                <div class="flex-shrink-0 w-16 h-16">
                  @if (item.coverImageUrl) {
                    <img 
                      [src]="item.coverImageUrl" 
                      [alt]="item.productName"
                      class="w-full h-full object-cover rounded"
                    />
                  } @else {
                    <div class="w-full h-full bg-gradient-mystical rounded flex items-center justify-center">
                      <i class="pi pi-star text-white/50"></i>
                    </div>
                  }
                </div>

                <!-- Info -->
                <div class="flex-1">
                  <h4 class="text-primary font-medium">{{ item.productName }}</h4>
                  <p class="text-secondary text-sm">
                    {{ getProductTypeLabel(item.productType) }} • Qtd: {{ item.quantity }}
                  </p>
                  @if (item.questions && item.questions[0]) {
                    <p class="text-secondary text-xs mt-1 italic truncate">
                      "{{ item.questions[0] }}"
                    </p>
                  }
                </div>

                <!-- Price -->
                <div class="text-right">
                  <p class="text-accent font-bold">{{ item.price * item.quantity | currencyBrl }}</p>
                </div>
              </div>
            }
          </div>

          <a routerLink="/loja/carrinho" class="inline-block mt-4 text-accent hover:text-accent-light transition-colors text-sm">
            <i class="pi pi-arrow-left mr-1"></i>
            Voltar ao carrinho
          </a>
        </div>

        <!-- Payment Info -->
        <div class="glass-card p-6">
          <h2 class="heading-3 text-primary mb-4 flex items-center gap-2">
            <i class="pi pi-shield"></i>
            Pagamento Seguro
          </h2>
          
          <p class="text-secondary mb-4">
            Ao clicar em "Pagar", você será redirecionado para a página de pagamento seguro do Stripe, 
            onde poderá escolher entre:
          </p>

          <div class="grid grid-cols-3 gap-4 mb-6">
            <div class="p-4 bg-dark/30 rounded-lg text-center">
              <i class="pi pi-credit-card text-2xl text-primary mb-2"></i>
              <p class="text-secondary text-sm">Cartão de Crédito</p>
            </div>
            <div class="p-4 bg-dark/30 rounded-lg text-center">
              <i class="pi pi-qrcode text-2xl text-primary mb-2"></i>
              <p class="text-secondary text-sm">PIX</p>
            </div>
            <div class="p-4 bg-dark/30 rounded-lg text-center">
              <i class="pi pi-file text-2xl text-primary mb-2"></i>
              <p class="text-secondary text-sm">Boleto</p>
            </div>
          </div>

          <div class="flex items-center gap-4 text-secondary text-sm">
            <i class="pi pi-lock text-accent"></i>
            <span>Seus dados são criptografados e protegidos</span>
          </div>
        </div>
      </div>

      <!-- Order Summary -->
      <div class="lg:col-span-2">
        <div class="glass-card p-6 sticky top-24">
          <h2 class="heading-3 text-primary mb-6">Resumo</h2>

          <!-- Items Summary -->
          <div class="space-y-3 pb-6 border-b border-primary/10">
            @for (item of items(); track item.productId) {
              <div class="flex justify-between text-secondary text-sm">
                <span>{{ item.productName }} (x{{ item.quantity }})</span>
                <span>{{ item.price * item.quantity | currencyBrl }}</span>
              </div>
            }
          </div>

          <!-- Totals -->
          <div class="space-y-3 py-6 border-b border-primary/10">
            <div class="flex justify-between">
              <span class="text-secondary">Subtotal:</span>
              <span class="text-primary">{{ subtotal() | currencyBrl }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-secondary">Desconto:</span>
              <span class="text-accent">R$ 0,00</span>
            </div>
          </div>

          <div class="flex justify-between py-6">
            <span class="text-primary font-bold text-lg">Total:</span>
            <span class="text-accent font-bold text-2xl">{{ total() | currencyBrl }}</span>
          </div>

          <!-- Terms -->
          <div class="mb-6">
            <p-checkbox 
              [(ngModel)]="acceptTerms"
              [binary]="true"
              inputId="terms"
            />
            <label for="terms" class="ml-2 text-secondary text-sm">
              Li e aceito os 
              <a routerLink="/termos" class="text-accent hover:underline">termos de uso</a> 
              e a 
              <a routerLink="/privacidade" class="text-accent hover:underline">política de privacidade</a>
            </label>
          </div>

          <!-- Pay Button -->
          <button 
            pButton 
            class="btn-primary w-full"
            [loading]="processing()"
            [disabled]="!acceptTerms() || isEmpty"
            (click)="processPayment()"
          >
            <i class="pi pi-lock mr-2"></i>
            Pagar {{ total() | currencyBrl }}
          </button>

          <!-- Security Info -->
          <div class="mt-6 text-center">
            <p class="text-secondary text-xs">
              <i class="pi pi-shield mr-1"></i>
              Pagamento processado de forma segura pelo Stripe
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
